# -*- mode: yaml -*-
default_experiment: all
default_data_file: 'runbench_experiment.data'

runs:
  max_invocation_time: 6000
  min_iteration_time: 1
  iterations: 100
  invocations: 30

benchmark_suites:
    macro-steady:
      gauge_adapter: RebenchLog
      command: &MACRO_STEADY "--jit function_threshold=%(variable)s -cp Smalltalk:Examples/Benchmarks/Json Examples/Benchmarks/BenchmarkHarness.som --gc %(benchmark)s %(iterations)s "
      variable_values: [7000]
      benchmarks:
        - Json:         {extra_args:    25}

    micro-steady:
      gauge_adapter: RebenchLog
      command: &MICRO_STEADY "--jit function_threshold=%(variable)s -cp Smalltalk:Examples/Benchmarks/GraphSearch:Examples/Benchmarks/NBody:Examples/Benchmarks/LanguageFeatures:Examples/Benchmarks/TestSuite Examples/Benchmarks/BenchmarkHarness.som --gc %(benchmark)s %(iterations)s "
      variable_values: [1669]
      benchmarks:
        - Bounce:         {extra_args:    350}
        - BubbleSort:     {extra_args:    500}
        - Fannkuch:       {extra_args:      9}
        - Fibonacci:      {extra_args:    500}
        - List:           {extra_args:    500}
        - Mandelbrot:     {extra_args:    350}
        - NBody:          {extra_args:    125000}
        - PageRank:       {extra_args:    350}
        - Permute:        {extra_args:    250}
        - Queens:         {extra_args:    250}
        - QuickSort:      {extra_args:    500}
        - Recurse:        {extra_args:    500}
        - Sieve:          {extra_args:    1250}
        - Storage:        {extra_args:    350}
        - Sum:            {extra_args:    500}
        - TreeSort:       {extra_args:    350}
        - Towers:         {extra_args:    350}

    experiment-shuffle:
      gauge_adapter: PlainSecondsLog
      command: &EXPERIMENT_CMD "-cp Smalltalk:Examples/Benchmarks:Examples/Benchmarks/NBody:Examples/Benchmarks/Json:Examples/Benchmarks/DeltaBlue:Examples/Benchmarks/CD Examples/Benchmarks/Experiment/%(benchmark)s.som"
      invocations: 100
      benchmarks:
        - Experiment1
        - Experiment2
        - Experiment3
        - Experiment4
        - Experiment5
        - Experiment6
        - Experiment7
        - Experiment8
        - Experiment9
        - Experiment10
        - Experiment11
        - Experiment12
        - Experiment13
        - Experiment14
        - Experiment15
        - Experiment16
        - Experiment17
        - Experiment18
        - Experiment19
        - Experiment20
        - ExperimentRandom

executors:
    RPySOM-bc-jit-tier1:
        path: .
        executable: som-bc-jit-tier1
    RPySOM-bc-jit-tier1-no-ic:
        path: .
        executable: som-bc-jit-tier1-no-ic
    RPySOM-bc-jit-tier1-no-ic-no-handler-opt:
        path: .
        executable: som-bc-jit-tier1-no-ic-no-handler-opt
    RPySOM-bc-jit-tier2:
        path: .
        executable: som-bc-jit-tier2
    RPySOM-bc-jit-tier2-high-threshold:
        path: .
        args: --jit function_threshold=7000
        executable: som-bc-jit-tier2
    RPySOM-bc-interp-w-prof:
        path: .
        args: --jit off
        executable: som-bc-jit-tier1
    RPySOM-bc-interp:
        path: .
        executable: som-bc-interp-tier1
    RPySOM-bc-jit-hybrid:
        path: .
        executable: som-bc-jit-hybrid
        args: --jit threshold=23

experiments:
  PySOM:
    description: All benchmarks on RPySOM
    executions:
      - RPySOM-bc-jit-tier1:
          suites:
            - experiment-shuffle
      - RPySOM-bc-jit-tier2:
          suites:
            - micro-steady
            - macro-steady
            - experiment-shuffle
      - RPySOM-bc-jit-tier2-high-threshold:
          suites:
            - experiment-shuffle
      - RPySOM-bc-interp:
          suites:
            - experiment-shuffle
      - RPySOM-bc-interp-w-prof:
          suites:
            - experiment-shuffle
      - RPySOM-bc-jit-hybrid:
          suites:
            - micro-steady
            - macro-steady
            - experiment-shuffle
